# Question 3: Boundary Value Problem with PETSc (20 pts)

BVP: $-u''(x) + \gamma u(x) = f(x)$ on $x \in [0, 1]$ with Dirichlet boundary conditions.

**(a)** Find $f(x)$ for the manufactured solution $u(x) = \sin(k\pi x) + c(1 - 1/2)^3$ ($k$ positive integer, $c$ real constant).

**(b)** Modify **tri.c** (p4pdes Ch 2) to solve this BVP with PETSc:
- Run with `mpiexec -np P ./bvp -options_file options_file`
- Assemble matrix and RHS in parallel; use **MatZeroRowsColumns** after assembly to enforce Dirichlet BCs and keep symmetry
- Compute and print relative error
- Rebuild PETSc with `--download-hdf5`; output solution, exact solution, and RHS to HDF5 (snippet provided)
- Use provided **plot_bvp.py** to visualize

**(c)** Modify **plot_bvp.py** to plot error vs $h$ for $\gamma = 0$, $k = 1, 5, 10$, and $m = 40, 80, 160, \ldots, 1280$. Report observed order of convergence.

---

## Solution

### Part (a): Manufactured solution and $f(x)$

With $u(x) = \sin(k\pi x) + c(1 - 1/2)^3 = \sin(k\pi x) + c/8$ we have $u'(x) = k\pi\cos(k\pi x)$ and $u''(x) = -k^2\pi^2\sin(k\pi x)$. So

$$-u'' + \gamma u = k^2\pi^2\sin(k\pi x) + \gamma\sin(k\pi x) + \frac{\gamma c}{8},$$

hence

$$f(x) = (k^2\pi^2 + \gamma)\sin(k\pi x) + \frac{\gamma c}{8}.$$

*(If the intended solution was $u(x) = \sin(k\pi x) + c(1-x)^3$, then $f$ would include extra terms from the $(1-x)^3$ part.)*

### Part (b): BVP code

See **bvp.c** in this directory. It uses $N = m+1$ dofs (grid points $x_i = ih$, $i = 0,\ldots,m$); assembles the $N\times N$ matrix with stencil $(1/h^2)(-1, 2, -1) + \gamma$ on the diagonal; builds RHS and exact solution; calls **MatZeroRowsColumns** on rows $0$ and $m$ to enforce Dirichlet BCs and preserve symmetry; solves, computes relative error $\|u - u_{\text{exact}}\|/\|u_{\text{exact}}\|$, and writes **u**, **f**, **uexact** to **bvp_solution.h5**.

**Build and run:**
```bash
# PETSc is sibling of apma4302_dad2232 (same parent directory)
export PETSC_DIR=/Users/dan/Desktop/Columbia/HPC_4302/petsc
# If you get "arch-name/... No such file", unset PETSC_ARCH (you may not use a named arch):
unset PETSC_ARCH

make bvp
mpiexec -np 1 ./bvp -options_file options_file
python plot_bvp.py   # plot solution from bvp_solution.h5
```

### Part (c): Convergence study

**plot_bvp.py** can run the convergence study: it executes the BVP for $m = 40, 80, 160, 320, 640, 1280$ and $k = 1, 5, 10$ (with $\gamma = 0$), parses the relative error from stdout, and plots error vs $h$ on a log-log scale. The slope of $\log(\text{error})$ vs $\log(h)$ is the observed order.

**Run convergence study:**
```bash
python plot_bvp.py convergence ./bvp
```

The centered second-order scheme gives expected order $\approx 2$ (error $\sim h^2$).
